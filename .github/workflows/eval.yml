name: eval
on:
  workflow_call:

jobs:
  eval:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.x"
      - name: Install eval runner deps (optional)
        run: |
          if [ -f runner/requirements.txt ]; then
            python3 -m pip install -U pip
            python3 -m pip install -r runner/requirements.txt
          else
            echo "No runner/requirements.txt; skipping."
          fi
      - name: Always pass (v0.1)
        run: echo "eval ok"
      - name: Orphaned assets check
        if: ${{ hashFiles('runner/run_repo_checks.py') != '' }}
        run: python3 runner/run_repo_checks.py --check orphaned_assets --repo .
      - name: Agent safety check
        if: ${{ hashFiles('runner/run_repo_checks.py') != '' }}
        run: python3 runner/run_repo_checks.py --check agent_safety --repo .
      - name: Gate A smoke check
        if: ${{ hashFiles('runner/run_repo_checks.py') != '' }}
        run: python3 runner/run_repo_checks.py --check gate_a_smoke --repo .
      - name: Runbook checksum guard
        if: ${{ hashFiles('runner/run_repo_checks.py') != '' }}
        run: python3 runner/run_repo_checks.py --check runbook_checksums --repo .
